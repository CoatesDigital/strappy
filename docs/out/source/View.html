<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='framework-mvc-View'>/**
</span> * @class framework.mvc.View
 * 
 * TODO:
 * 
 * Explanation &amp; Examples.
 * 
 * @mixins framework.trait.ComponentConnector
 * @abstract
 * 
 * @uses framework.trait.ComponentConnector
 * @uses framework.trait.signal.Receive
 * @uses framework.trait.signal.Send
 */
$JSKK.Class.create
(
	{
		$namespace:		'framework.mvc',
		$name:			'View',
		$abstract:		true,
		$uses:
		[
			framework.trait.ComponentConnector,
			$JSKK.trait.Observable
		]
	}
)
(
	{},
	{
		events:
		{
			onGotBaseHTML:		true,
			onInsertBaseHTML:	true,
			onReady:			true,
			onShow:				true,
			onHide:				true
		},
		
        _iid:			null,
		_ready:			false,
		_stateBindings:	{},
        contentURL:		null,
		baseHTML:		null,
		element:		null,
        // TODO: COMPOSITE PATTERN -&gt; See bottom off this Class
        // children: [],

<span id='framework-mvc-View-method-constructor'>        /**
</span>        * @constructor
        * 
        * 
        */
		init: function()
		{
			this.generateInstanceID();
			
			this.fetchContent();
		},
<span id='framework-mvc-View-method-fetchContent'>		/**
</span>		 * 
		 */
		fetchContent: function()
		{
			$.get
			(
				(this.$reflect('namespace').replace(/\./g,'/'))+'/html/'+this.$reflect('name').toLowerCase()+'.html',
				function(response)
				{
					this.baseHTML=response;
					this.fireEvent('onGotBaseHTML',this);
				}.bind(this)
			);
		},
<span id='framework-mvc-View-method-insertBaseHTML'>		/**
</span>		 * 
		 */
		insertBaseHTML: function(config)
		{
			console.debug('insertBaseHTML');
			var	view=$(this.getBaseHTML());
			
			view.attr('id',this.getIID());
			$(config.where)[config.how](view);
			this.fireEvent('onInsertBaseHTML',this);
			this._ready=true;
			this.onReady();
			this.fireEvent('onReady',this);
			return this;
		},
<span id='framework-mvc-View-method-getBaseHTML'>		/**
</span>		 * 
		 */
		getBaseHTML: function()
		{
			return this.baseHTML;
		},
<span id='framework-mvc-View-property-onReady'>		/**
</span>		 * 
		 * @abstract
		 */
		onReady:		$JSKK.emptyFunction,
<span id='framework-mvc-View-property-onViewInit'>		/**
</span>		 * 
		 * @abstract
		 */
		onViewInit: 	$JSKK.emptyFunction,
<span id='framework-mvc-View-property-onStoreChange'>		/**
</span>		 * 
		 * @abstract
		 */
		onStoreChange:	$JSKK.emptyFunction,
<span id='framework-mvc-View-property-syncView'>		/**
</span>		 * 
		 */
		syncView:		$JSKK.Class.ABSTRACT_METHOD,
<span id='framework-mvc-View-method-generateInstanceID'>		/**
</span>		 * 
		 */
		generateInstanceID: function()
		{
			var	chars	='0123456789abcdefghijklmnopqrstuvwxyz'.split(''),
				iid		=[];
			for (var i=0; i&lt;8; i++)
			{
				iid.push(chars[Math.floor(Math.random()*25)]);
			}
			this._iid=this.getSafeID()+'-'+iid.join('');
		},
<span id='framework-mvc-View-method-getIID'>		/**
</span>		 * 
		 */
		getIID: function()
		{
			return this._iid;
		},
//		bindEventToSignal: function()
//		{
//			// empty function
//		},
<span id='framework-mvc-View-method-getContainerClass'>		/**
</span>		 * 
		 */
		getContainerClass: function()
		{
			return '.'+this.getSafeID();
		},
<span id='framework-mvc-View-method-getContainer'>		/**
</span>		 * 
		 */
		getContainer: function()
		{
			return $('#'+this.getIID());
		},
<span id='framework-mvc-View-method-show'>		/**
</span>		 * 
		 */
		show: function()
		{
			console.debug('onShow');
			this.getContainer().fadeIn(500);
			this.fireEvent('onShow',this);
			return this;
		},
<span id='framework-mvc-View-method-hide'>		/**
</span>		 * 
		 */
		hide: function()
		{
			console.debug('onHide');
			this.getContainer().fadeOut(500);
			this.fireEvent('onHide',this);
			return this;
		},
<span id='framework-mvc-View-method-bindStatefulLinks'>		/**
</span>		 * 
		 */
		bindStatefulLinks: function()
		{
			var links=$JSKK.toArray(arguments);
			$JSKK.when(this,'_ready').isTrue
			(
				function()
				{
					var item=null;
					for (var i=0,j=links.length; i&lt;j; i++)
					{
						item=$(links[i][0],this.getContainer());
						if (item.length)
						{
							this.getStateMgr().registerStateChanger(item,links[i][1]);
						}
					}
				}.bind(this)
			);
			return this;
		},
<span id='framework-mvc-View-method-bindStateEvents'>		/**
</span>		 * 
		 */
		bindStateEvents: function(bindings)
		{
			for (var item in bindings)
			{
				if (Object.isFunction(this[bindings[item]]))
				{
					this._stateBindings[item]=this[bindings[item]].bind(this);
				}
				else
				{
					throw new Error('Unable to bind state change event for stateful property &quot;'+item+'&quot; because the method &quot;'+bindings[item]+'&quot; '
									+'has not been defined on view class &quot;'+this.$reflect('namespace')+'.'+this.$reflect('name')+'');
				}
			}
//			for (var i=0,j=bindings.length; i&lt;j; i++)
//			{
//				
//			}
			return this;
		},
//		bindStoreChange: function(store,bindings)
//		{
//			for (var item in bindings)
//			{
//				if (Object.isFunction(this[bindings[item]]))
//				{
//					this._storeBindings[item]=this[bindings[item]].bind(this);
//				}
//				else
//				{
//					throw new Error('Unable to bind store change event for property &quot;'+item+'&quot; because the method &quot;'+bindings[item]+'&quot; '
//									+'has not been defined on view class &quot;'+this.$reflect('namespace')+'.'+this.$reflect('name')+'');
//				}
//			}
//			return this;
//		},
<span id='framework-mvc-View-method-onStateChange'>		/**
</span>		 * 
		 */
		onStateChange: function(signal)
		{
			console.debug('onStateChange');
			var changeSet=signal.getBody().change;
			for (var item in changeSet)
			{
				if (Object.isFunction(this._stateBindings[item]))
				{
					this._stateBindings[item](changeSet[item]);
				}
			}
		}
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		

        // TODO: COMPOSITE PATTERN?
        // TODO: Consider Composite Design pattern to distinguish between DOM related events passed down the tree from MVC signals
        // update: function(msg){
        //  $each(var child in this.children){
        //          child.update(msg);
        //      }
        // }
        // TODO: IF COMPOSITE PATTERN then -&gt; Bring in convenience methods
        //  getChild(x), addChild(x), removeChild(x)
    }
);</pre>
</body>
</html>
